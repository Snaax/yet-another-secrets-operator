# Yet Another Secrets Operator

## Overview

Yet Another Secrets Operator (YASO) synchronizes secrets between Kubernetes and AWS Secrets Manager, with support for automatic secret generation.

## Custom Resources

### Create an AGenerator

Create an `AGenerator` that defines password generation rules:

```yaml
apiVersion: yet-another-secrets.io/v1alpha1
kind: AGenerator
metadata:
  name: password-generator
spec:
  length: 16
  includeUppercase: true
  includeLowercase: true
  includeNumbers: true
  includeSpecialChars: true
  specialChars: "!@#$%^&*()-_=+[]{}|;:,.<>?/"
```

### Create an ASecret

Create an `ASecret` that defines your secret:

```yaml
apiVersion: yet-another-secrets.io/v1alpha1
kind: ASecret
metadata:
  name: app-secrets
  namespace: default
spec:
  targetSecretName: my-app-secret
  awsSecretPath: /my-app/secrets
  data:
    username:
      value: admin
    password:
      generatorRef:
        name: password-generator
    apiKey:
      value: ""
```

## How it works

1. The operator checks if the secret exists in AWS Secrets Manager.
2. If the AWS secret exists, it creates or updates the Kubernetes Secret with those values.
3. If there are keys in the ASecret that aren't in the AWS Secret or Kubernetes Secret, they get added (either using the hardcoded value or by generating one).
   1. (optional) if you set removeRemoteKeys, then it'll also remove the remote keys that are not in the ASecret
4. If the AWS secret doesn't exist, the operator pushes the Kubernetes Secret data to AWS.
5. The operator maintains sync between both systems, always respecting the priority order.

## Secret Generation Rules

- If an autogenerated value already exists in a Kubernetes Secret, it will never be overwritten.
- When generating values, the operator uses the specified generator's configuration (character sets, length, etc.).
- All generators have sane defaults enabled (uppercase, lowercase, numbers, special chars).

## AWS Authentication

!!! Only Pod Identity authentication is active for now !!!
For details on AWS authentication methods supported by this operator, please see our [AWS Authentication Guide](docs/aws-authentication.md).

## Installation

For installation instructions using Helm, please see our [Helm Installation Guide](README-helm.md).

### 2. Update examples/asecret-sample.yaml

The example seems consistent with your API group but should be reviewed to ensure it aligns with your implementation:

```yaml examples/asecret-sample.yaml
apiVersion: yet-another-secrets.io/v1alpha1
kind: ASecret
metadata:
  name: asecret-sample
  namespace: yaso
spec:
  targetSecretName: my-secret
  awsSecretPath: /path/to/aws/secret
  data:
    username:
      value: admin
    password:
      generatorRef:
        name: password-generator
    apiKey:
      value: ""
    dbPassword:
      generatorRef:
        name: strong-password-generator
```
